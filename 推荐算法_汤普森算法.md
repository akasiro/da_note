## 1、β分布
+ ### 1.1 定义：
+ 所谓的以 $\alpha, \beta$ 为参数的 Beta 分布$f(x; \alpha, \beta)$ ，其实描述的就是我们在做抛硬币的过程中，我们当前如果已经观测到 $α+1$ 次正面， $\beta + 1$ 次反面，那么此时硬币正面朝上的真实概率的可能性分布。
+ ### 1.2 推导
+ #### 解决的问题：
+ 抛硬币抛了A+B次，A次正面，B次方面，问硬币正面的概率p是多少，或者说p的概率分布是什么样子的。
+ #### 答案：
+ p的概率分布就是β分布
+ #### 公式推导：
> 假设硬币正面的概率为参数$\theta$（$\theta \in [0,1]$），那么在这一情况下出现A次正面的概率为
> $P(A|{\theta}) = C_{A+B}^{A}\theta^A(1-\theta)^B$ (似然)
> 将上述概率改写为函数：
> $f(\theta) = C_{A+B}^{A}\theta^A(1-\theta)^B, \theta \in [0,1]$
> 将函数归一化就是$\theta$的概率分布
> $P(\theta)= \frac{f(\theta)}{\int_{0}^{1} f(\theta)d\theta} = \frac{C_{A+B}^{A}\theta^A(1-\theta)^B}{\int_{0}^{1} C_{A+B}^{A}\theta^A(1-\theta)^B d\theta} = \frac{\theta^A(1-\theta)^B}{\int_{0}^{1} \theta^A(1-\theta)^B d\theta}$
> 对公式进行一定调整，为了方面重新假设抛了硬币$\alpha + \beta - 2$次，其中$\alpha-1$次为正面，那么
> $f(x; \alpha,\beta) = \frac{x^{\alpha-1}(1-x)^{\beta-1}}{\int_0^1 \mu^{\alpha-1}(1-\mu)^{\beta-1} d\mu} = \frac{\Gamma (\alpha +\beta)}{\Gamma(\alpha)\Gamma(\beta)}x^{\alpha-1}(1-x)^{\beta-1} = \frac{1}{B(\alpha,\beta)}x^{\alpha-1}(1-x)^{\beta-1}$
> 其中 $\frac{1}{B(\alpha,\beta)} = \frac{\Gamma (\alpha +\beta)}{\Gamma(\alpha)\Gamma(\beta)}$ 为$\beta$函数，$\Gamma(x)$为伽马函数

![[Pasted image 20230810173349.png]]

## 2、汤普森采样
汤普森采样的背后原理正是上述所讲的$\beta$分布，你把$\beta$分布的 a 参数看成是推荐后用户点击的次数，把分布的 b 参数看成是推荐后用户未点击的次数，则汤普森采样过程如下：

　　1、取出每一个候选对应的参数 a 和 b；  
　　2、为每个候选用 a 和 b 作为参数，用贝塔分布产生一个随机数；  
　　3、按照随机数排序，输出最大值对应的候选；  
　　4、观察用户反馈，如果用户点击则将对应候选的 a 加 1，否则 b 加 1；

> 注：实际上在推荐系统中，要为每一个用户都保存一套参数，比如候选有 m 个，用户有 n 个，那么就要保存 2 m n个参数。

汤普森采样为什么有效呢？

1）如果一个候选被选中的次数很多，也就是 a+b 很大了，它的分布会很窄，换句话说这个候选的收益已经非常确定了，就是说不管分布中心接近0还是1都几乎比较确定了。用它产生随机数，基本上就在中心位置附近，接近平均收益。

2）如果一个候选不但 a+b 很大，即分布很窄，而且 a/(a+b) 也很大，接近 1，那就确定这是个好的候选项，平均收益很好，每次选择很占优势，就进入利用阶段。反之则有可能平均分布比较接近与0，**几乎再无出头之日**。

3）如果一个候选的 a+b 很小，分布很宽，也就是没有被选择太多次，说明这个候选是好是坏还不太确定，那么分布就是跳跃的，这次可能好，下次就可能坏，也就是还有机会存在，没有完全抛弃。那么用它产生随机数就有可能得到一个较大的随机数，在排序时被优先输出，这就起到了**前面说的探索作用**
## Reference
[推荐算法之Thompson(汤普森)采样 - 光彩照人 - 博客园 (cnblogs.com)](https://www.cnblogs.com/gczr/p/11220187.html)
如何通俗理解 beta 分布？ - 知乎 https://www.zhihu.com/question/30269898
[Β分布 - 维基百科，自由的百科全书 (wikipedia.org)](https://zh.wikipedia.org/zh-hans/%CE%92%E5%88%86%E5%B8%83)
